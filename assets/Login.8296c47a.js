import{g as k,r as a,s as t,h as m,c as u,b as p,t as h,F as _,i as g,e as c}from"./index.8172a0e3.js";const b=["textContent"],y=["disabled"],w={key:1},T={__name:"Login",setup(x){const r=k.auth;console.log("auth server: "+r);const s=a(""),l=a(!1),o=a("\u8FDE\u63A5\u5230 \u83B1\u4E91"),n=a(!1);console.log("store token:",t.state.token),console.log("store user:",t.state.user);const f=()=>{n.value=!0,o.value="\u6B63\u5728\u9A8C\u8BC1\u767B\u5F55...",t.commit("updateToken",s.value),g.get("/users").then(e=>{t.commit("updateUser",e.data),console.log(e.data),o.value="\u55E8, "+e.data.name,n.value=!1,l.value=!0,m.push("/"),location.href="/"}).catch(e=>{console.error(e),t.commit("updateToken",{token:null}),o.value="\u65E0\u6CD5\u9A8C\u8BC1\u767B\u5F55\uFF0C\u5C06\u5728\u51E0\u79D2\u949F\u540E\u91CD\u8BD5\u3002",n.value=!1}),s.value=""},i=m.currentRoute.value.query;i.token!=null?(s.value=i.token,f()):(l.value=!1,setTimeout(d,1e3));function d(){window.location.href=r+"/?callback="+encodeURIComponent(window.location.href)}return(e,v)=>(c(),u(_,null,[p("h1",{textContent:h(o.value)},null,8,b),p("div",null,[l.value?(c(),u("button",{key:0,onClick:v[0]||(v[0]=C=>d()),disabled:n.value,type:"button",class:"btn btn-outline-primary"}," \u524D\u5F80 \u83B1\u4E91 ",8,y)):(c(),u("p",w,"\u6211\u4EEC\u6B63\u5728\u5C06\u4F60\u91CD\u5B9A\u5411\u5230 \u83B1\u4E91..."))])],64))}};export{T as default};
